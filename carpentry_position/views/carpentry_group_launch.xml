<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <!-- Launches -->
    <record id="action_open_launch" model="ir.actions.act_window">
        <field name="name">Launches</field>
        <field name="res_model">carpentry.group.launch</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="carpentry_group_phase_search" />
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a first Launch.
            </p>
            <p>
                Launches are the Positions' group planned to be manufactured, a little
                before Manufacturing Order. They are the steering units of the project,
                like sub-projects: every Purchase Orders, Manufacturing Orders, etc.
                can be linked to 1 or several launchs.

                The Project Planning is steered by Launches.
            </p>
        </field>
    </record>
    <record id="action_open_launch_srv" model="ir.actions.server">
        <!-- Preselect-action of project wizard before opening real action -->
        <field name="name">Launches</field>
        <field name="model_id" ref="project_favorite_switch.model_project_choice_wizard" />
        <field name="state">code</field>
        <field name="code">action = model.action_choose_project_and_redirect('carpentry_position.action_open_launch')</field>
    </record>
    
    <!-- Launch (tree) -->
    <record id="carpentry_group_launch_tree" model="ir.ui.view">
        <field name="name">carpentry.group.launch.tree</field>
        <field name="model">carpentry.group.launch</field>
        <field name="inherit_id" ref="carpentry_group_phase_tree" />
        <field name="mode">primary</field>

        <field name="arch" type="xml">
            <header position="replace" />

            <field name="lot_ids" position="attributes">
                <attribute name="name">phase_ids</attribute>
            </field>
        </field>
    </record>
    <!-- Launch (form) -->
    <record id="carpentry_group_launch_form" model="ir.ui.view">
        <field name="name">carpentry.group.launch.form</field>
        <field name="model">carpentry.group.launch</field>
        <field name="inherit_id" ref="carpentry_group_phase_form" />
        <field name="mode">primary</field>

        <field name="arch" type="xml">
            <!-- Button & `lot_ids` -->
            <label for="lot_ids" position="attributes">
                <attribute name="for">phase_ids</attribute>
            </label>
            <field name="lot_ids" position="attributes">
                <attribute name="name">phase_ids</attribute>
            </field>

            <field name="affectation_ids" position="before">
                <button name="button_affect_all_positions"
                    type="object"
                    colspan="2"
                    class="btn btn-success mt-4 oe_right text-uppercase"
                    icon="fa-hand-o-down"
                    string="Affect all"
                />
            </field>

            <!-- Different tree view for launches' affectations -->
            <field name="affectation_ids" position="attributes">
                <attribute name="context">{
                    'tree_view_ref': 'carpentry_position.carpentry_affectation_tree_launch',
                }</attribute>
            </field>
        </field>
    </record>

</odoo>
